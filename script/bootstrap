#!/usr/bin/env bash
#/ Usage: script/bootstrap
#/
#/ Set up repository dependencies.
#/ Based on the scripts-to-rule-them-all pattern: https://github.com/github/scripts-to-rule-them-all
script_dir=$(dirname "$(readlink -f "$0")")
cd "$script_dir/.."
repo_root="$PWD"

while [[ "$#" -gt 0 ]]; do
    key="$1"
    shift
    case "$key" in
        -h|--help) 
            grep '^#/' <"$0" | cut -c4-
            exit 0
            ;;
        *) 
            echo "Unknown parameter passed: $1"
            exit 1
            ;;
    esac
done

echo "Checking dependencies we don't auto-install..."

echo "Creating and entering virtualenv..."
python3 -m venv ./.venv
source ./.venv/bin/activate
pip install -r ./python/dev-requirements.txt

echo "Installing Maturin..."
cargo install --locked maturin
make prep